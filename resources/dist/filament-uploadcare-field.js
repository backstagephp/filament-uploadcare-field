function y(s){return{state:s.state,statePath:s.statePath,initialState:s.initialState,publicKey:s.publicKey,isMultiple:s.isMultiple,multipleMin:s.multipleMin,multipleMax:s.multipleMax,isImagesOnly:s.isImagesOnly,accept:s.accept,sourceList:s.sourceList,uploaderStyle:s.uploaderStyle,uploadedFiles:"",ctx:null,removeEventListeners:null,init(){this.applyTheme(),this.initUploadcare(),this.setupThemeObservers()},applyTheme(){let r=localStorage.getItem("theme"),l=r==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":r;document.querySelectorAll("uc-file-uploader-inline").forEach(o=>o.classList.add(`uc-${l}`))},setupThemeObservers(){window.addEventListener("storage",l=>{l.key==="theme"&&this.applyTheme()}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{localStorage.getItem("theme")==="system"&&this.applyTheme()})},initUploadcare(){this.removeEventListeners&&this.removeEventListeners();let r=()=>{this.ctx=document.querySelector(`uc-upload-ctx-provider[ctx-name="${this.statePath}"]`);let l;try{if(l=this.ctx?.getAPI(),!l||!l.addFileFromCdnUrl){setTimeout(r,100);return}}catch{setTimeout(r,100);return}if(!this.ctx||!l)return;if(setTimeout(()=>{document.querySelectorAll("uc-form-input input[required]").forEach(t=>{t.removeAttribute("required")})},100),this.initialState)try{let e=typeof this.initialState=="string"?JSON.parse(this.initialState):this.initialState;if(Array.isArray(e))e.forEach(t=>{let i=typeof t=="object"?t.cdnUrl:t;l.addFileFromCdnUrl(i)});else{let t=typeof e=="object"?e.cdnUrl:e;l.addFileFromCdnUrl(t)}this.uploadedFiles=JSON.stringify(e)}catch(e){console.error("Error parsing initialState:",e)}let c=e=>{let t=e.detail.cdnUrl,i=this.uploadedFiles?JSON.parse(this.uploadedFiles):[];i.push(t),this.uploadedFiles=JSON.stringify(i),this.state=this.uploadedFiles},o=e=>{let t=e.detail;if(t.cdnUrlModifiers&&t.cdnUrlModifiers!==""){let i=this.uploadedFiles?JSON.parse(this.uploadedFiles):[],n=((u,d)=>u.findIndex(a=>(typeof a=="object"?a.cdnUrl:a).includes(d)))(i,t.uuid);n>-1&&(i[n]=t.cdnUrl),this.uploadedFiles=JSON.stringify(i),this.state=this.uploadedFiles}},h=e=>{let t=e.detail.cdnUrl,i=this.uploadedFiles?JSON.parse(this.uploadedFiles):[],n=((u,d)=>u.findIndex(a=>{let p=typeof a=="object"?a.cdnUrl:a,f=typeof d=="object"?d.cdnUrl:d;return p===f}))(i,t);n>-1&&i.splice(n,1),this.uploadedFiles=JSON.stringify(i),this.state=this.uploadedFiles};this.ctx.addEventListener("file-upload-success",c),this.ctx.addEventListener("file-url-changed",o),this.ctx.addEventListener("file-removed",h),this.removeEventListeners=()=>{this.ctx.removeEventListener("file-upload-success",c),this.ctx.removeEventListener("file-url-changed",o),this.ctx.removeEventListener("file-removed",h)}};r()}}}export{y as default};
